# Backlift basics

## App templates

Backlift comes with a set of examples and starter templates that you can access directly with the backlift create command. Just type:

    backlift create:<template_name> newapp 

You can find a list of available templates on github at http://github.com/backlift/backlift-templates.

We'd love to add your example or starter template to the backlift command line utility. Just submit a pull request to the github project above. We'll evaluate it and, if we approve, we'll make it available directly by typing `backlift create:<your app here>`.

## Project layout

At the root of your project folder is a public folder. This contains all the publicly accessible files that make up your webapp. At a minimum your backlift app should have a main javascript file, one ore more handlebars or underscore templates and a CSS file. Typically these files will be placed in the following folders:

* **/public/app/scripts/ **: At a minimum this folder should contain a main.js file that defines a Backbone router. This file can also contain .js files for your data Models and Collections, and Views that display the data.

* **/public/app/templates/ **: This folder should contain templates using either the underscore or handlebars template syntax. They should have the .jst or .handlebars extensions respectively. Templates are combined with data from your model and "rendered" into HTML. Also templates can be rendered heirarchically, allowing one template to act as a layout for the rest of the website. For more information about the template compilers please see the section on [compilers](#compilers-and-optimization). 

* **/public/app/styles/ **: Should contain .css files that define the look and layout of your webapp.

There are a few additional project files:

* **the /public/libraries folder**: This is where third party libraries, such as bootstrap.css and backbone.js go.

* **the /public/setup.js file**: For some backlift template, a setup javascript file is used to create the App namespace.

* **the config.yml file**: This is the configuration file that determines how your project is packaged, and can be used to define server side validation rules.

After your files are uploaded using `backlift push` they will be publicly accessible at:

    https://<your_app_id>.backliftapp.com/public/<file_path> 

This avoids conflicts between your public files, and paths that you might set up using your backbone router.

You may have noticed that index.html was not on the above list. If no index.html file exists in the project, backlift will create one automatically that includes links to the scripts, styles, templates that were generated based on your config.yml file.

## Compilers and optimization

When you run `backlift push` your code is uploaded to the backlift server and optionally compiled and optimized. During the compilation phase, files with known extensions are compiled into javascript or css. During the optimization phase, javascript and css files are concatenated and minified. 

The following is a list of the known file extensions, the type of file generated, and the associated compiler:

* .coffeescript --&gt; .js (coffeescript compiler)
* .jst --&gt; .js (underscore template compiler)
* .handlebars --&gt; .js (handlebars template compiler)
* .less --&gt; .css (less compiler)

Backlift uses the YUI compressor to minify the concatenated javascript and css files.

You can control which files are passed to the compilers by adding a `compile` directive to your project's config.yml file. The compile directive should include a list of files that will be compiled. The default, if no compile directive is specified, includes the following:

<pre><code class="no-highlight">compile:
- public/**/*.jst
- public/**/*.handlebars
- public/**/bootstrap*.less
- public/**/*.coffee
</code></pre>

(Note that only the main bootstrap.less file will typically be compiled. This is because the bootstrap.less file imports several .less components. Attempting to pass those component .less files directly to the less compiler will result in an error.)

Typically it will not be necessary to adjust the compile configuration. If no files of a particular kind exist, the compiler for that file type will not be invoked.

Optimization can be enabled or disabled using the `optimize` setting within config.yml.

	optimize: on

By default optimization is disabled. This reduces the time required to build your webapp, and avoides the obscure code generated by minification. Optimization should not be used during development.

If you do not include an index.html file in your project, one will be generated automatically that includes the results of the compile and optimize process. If you manually specify an index.html file, be sure to link the files generated by the compiler and optimizer. Compiled files will be named the same as their source file except for the extension. The optimizer will generate two files, `\public\optimized-scripts.js` and `\public\optmized-styles.css`.

## The admin site

Each app gets a unique admin page that can be used for debugging and, in the future, managing security features like validation and authorization. You can view your app's admin page by running:

    backlift admin

from your app's working folder, or visit

    https://www.backlift.com/admin#<app_id>

As you develop your app, this page will change to reflect your app's collections and request history. This makes it a valuable debugging tool.


## Data persistence

When communicating with the Backlift server, as long as you prefix your AJAX urls with "/backliftapp/", the backlift server will automatically store and fetch any json data that you send. For example, in backbone, you can set the url attribute of your collections, or the urlRoot attribute of your models using the "/backliftapp/" prefix and then use backbone's standard save or create methods.

Specifically:

* GET /backliftapp/&lt;collection&gt;: will retrieve a list of the items in the collection.

* POST /backliftapp/&lt;collection&gt;: will create a new item and add it to the collection.

* PUT /backliftapp/&lt;collection&gt;/&lt;item_id&gt;: will update an item in the collection.

* DELETE /backliftapp/&lt;collection&gt;/&lt;item_id&gt;: will delete an item.

The data should be sent in the request body, and can either be a JSON object or a url-encoded set of key-value pairs. 

Backlift stores the data as JSON documents. That means you don't need to spend time defining the schema in advance. Backlift will happily persist any object with any set of attributes and make it available for retreival. Later when you want to deploy your app in a production environment, you can setup validation via the config.yml config file or the admin panel. (coming soon!)


## Special object attributes

Each time the backlift server persists a new object, a few attributes are applied automatically:

* **'id'**: If no id is set, the server will assign a unique uuid to each model and store it in the 'id' attribute. If there is an id, backlift will ensure that it is unique. 

* **'_owner'**: This attribute is automatically assigned to the currently logged-in user's id attribute, if there is a currently logged-in user. This value is read-only.

* **'_created'**: When a new object is created, this attribute is set with the current date and time in ISO standard format. This value is read-only.

* **'_modified'**: Each time an object is updated, this attribute is set with the current date and time in ISO standard format. This value is read-only.

* **'_id'**: Backlift mirrors the id attribute in an '_id' attribute. The '_id' attribute is the primary attribute used to store and retrieve data by the backlift database. In the future this attribute may be filtered out, so don't use it.