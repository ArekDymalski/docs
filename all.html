<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Backlift Documentation</title>
    <link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans&subset=latin">
    <link type="text/css" rel="stylesheet" href="/docs/css/reset.css">
    <link type="text/css" rel="stylesheet" href="/docs/css/docs.css">
    <link type="text/css" rel="stylesheet" href="/docs/css/print.css" media="print">
    <link type="text/css" rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/sunburst.min.css">
    
        <link type="text/css" rel="stylesheet" href="style.css">
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://yandex.st/highlightjs/6.1/highlight.min.js"></script>
    
    <script type="text/javascript" src="/docs/js/viewer.js"></script>
</head>
<body>
    <div id="page">
        <a name="top" />
        
            <header id="header">
                <h1><a href="/docs/">Backlift Documentation</a></h1>
            </header>
        
        <div id='content'><a name="backlift"></a><h1>Backlift</h1>
<a name="introduction"></a><h2>Introduction</h2>
<p>Backlift wants to make building and deploying websites easier, faster and more creative. 

</p>
<p>Backlift&#39;s server, templates and helper libraries support:

</p>
<ul>
<li><strong>Asynchronous updates:</strong> Build apps that respond immediately to user actions while data is sent the the server in the background. </li>
<li><strong>API discovery:</strong> Backlift will let you persist data without specifying the API up front. If you follow standard RESTful conventions, backlift will accept whatever data you throw at it.</li>
<li><strong>Familiar libraries:</strong> Backlift currently works with <a href="http://backbonejs.org">Backbone.js</a>. We plan to integrate other javascript MVC libraries in the future.</li>
</ul>
<p>Backlift&#39;s goals are to facilitate:

</p>
<ul>
<li>rapid user experience prototyping,</li>
<li>learning to write front-end javascript code, and eventually,</li>
<li>deploying production websites used by millions.</li>
</ul>
<p>Please visit <a href="https://www.backlift.com">backlift.com</a> to access your backlift account.

</p>
<p>Bugs or feature requests for backlift can be submitted to the <a href="http://github.com/backlift/docs/issues">issues</a> page of this documentation&#39;s github project.

</p>
<p>Our roadmap is posted <a href="http://roadma.ps/28R">here</a>.

</p>
<p>The source to this documentation is available <a href="http://github.com/backlift/docs">on github</a>. We will happily accept pull requests to the docs.


</p>
<a name="getting-started"></a><h1>Getting Started</h1>
<a name="setup-the-backlift-command-line-utility"></a><h2>Setup the Backlift Command Line Utility</h2>
<p>Open up your terminal and download the Backlift Command Line Interface (CLI) by typing:

</p>
<pre><code>sudo easy_install backlift</code></pre>
<p>Alternatively, you can use pip to install the Backlift CLI into a virtual environment.

</p>
<p>Once you have backlift installed, create an account at <a href="https://backlift.com">backlift.com</a> by clicking on the &#39;Sign-in&#39; button in the upper right corner. You will need a registration key. In order to obtain one please click the &#39;Get Early Access&#39; link and supply your email address. We will send you a key as soon as possible.

</p>
<p>Once you have your api-key, setup backlift with the command:

</p>
<pre><code>backlift setup &lt;api-key&gt;</code></pre>
<p>Now you&#39;re ready to create new apps and upload them to backlift.

</p>
<p>From time to time you should make sure that you have the most recent version of the Backlift CLI. You can check that by typing <code>backlift --version</code>. It should match the &#39;Backlift CLI current version&#39; listed on your account dashboard. You can update your Backlift CLI by entering the command 

</p>
<pre><code>sudo easy_install --update backlift.</code></pre>
<a name="create-and-upload-a-new-app"></a><h2>Create and Upload a new app</h2>
<p>Create a new app with the command:

</p>
<pre><code>backlift create newapp</code></pre>
<p>This will create a new folder in the current directory called &#39;newapp&#39; and begin downloading the backlift default project template. Once the project template has finished downloading, check it out by opening the &#39;newapp&#39; folder with a text editor.

</p>
<p>To see this app running on a public web server, first change directories into the &#39;newapp&#39; folder and type &#39;backlift push&#39;.

</p>
<pre><code>cd newapp
backlift push</code></pre>
<p>This will upload the content of the &#39;newapp&#39; folder to Backlift. Alternatively you can use the command:
    <code>backlift watch</code>

</p>
<p>The watch command will first upload the &#39;newapp&#39; folder and then wait for changes to the project. Any time you edit and save a file in the &#39;newapp&#39; folder while the watch command is running, your changes will automatically by synced to Backlift.


</p>
<a name="view-and-manage-your-app"></a><h2>View and manage your app</h2>
<p>You can launch a browser to view your app by typing:

</p>
<pre><code>backlift open</code></pre>
<p>You can alternatively view the website&#39;s admin page by typing:

</p>
<pre><code>backlift admin</code></pre>
<p>That&#39;s all there is to it! The basic Backlift template contains a tutorial that will show you how to build a backbone.js app with Backlift. 

</p>

<a name="backlift-basics"></a><h1>Backlift basics</h1>
<a name="app-templates"></a><h2>App templates</h2>
<p>Backlift comes with a set of examples and starter templates that you can access directly with the backlift create command. Just type:

</p>
<pre><code>backlift create:&lt;template name&gt; newapp </code></pre>
<p>You can find a list of available templates on github at <a href="http://github.com/backlift/backlift-templates">http://github.com/backlift/backlift-templates</a>.

</p>
<p>We&#39;d love to add your example or starter template to the backlift command line utility. Just submit a pull request to the github project above. We&#39;ll evaluate it and, if we approve, we&#39;ll make it available directly by typing <code>backlift create:&lt;your app here&gt;</code>.

</p>
<a name="project-layout"></a><h2>Project layout</h2>
<p>At a minimum your backlift app has three files, a main javascript file, a javascript template (JST) file and a CSS file:

</p>
<ul>
<li><p><strong>app/scripts/main.js</strong>: At a minimum this file contains a router that maps URLs to Views. It can also contain data Models and Collections, and Views that display the data. However it&#39;s generally best to separate out those classes and place them into other .js files.</p>
</li>
<li><p><strong>app/templates/*.jst</strong>: JST stands for JavaScript Template. Templates are combined with data from your model and &quot;rendered&quot; into HTML. Larger sites may have several templates, one for each chunk of data that will be displayed. Also JST files can be rendered heirarchically, allowing one JST to act as a layout for the rest of the website. JSTs will be available to your code via the <code>window.JST</code> object. For example, a template called &#39;home.jst&#39; will be available to your app as <code>window.JST.home</code> or just <code>JST.home</code>. </p>
</li>
<li><p><strong>app/styles/styles.css</strong>: controls how your website looks</p>
</li>
</ul>
<p>There are a few additional project files:

</p>
<ul>
<li><p><strong>the /libraries folder</strong>: This is where third party libraries, such as bootstrap.css and backbone.js go.</p>
</li>
<li><p><strong>the setup.js file</strong>: For some backlift template, a setup javascript file is used to create the App namespace and define commonly used convenience classes.</p>
</li>
<li><p><strong>the .backlift file</strong>: This is the configuration file that determines how your project is packaged, and can be used to define server side validation rules.</p>
</li>
</ul>
<p>After your files are uploaded using <code>backlift push</code> they will be publicly accessible at:

</p>
<pre><code>&lt;your app id&gt;.backliftapp.com/public/&lt;file path&gt; </code></pre>
<p>This avoids conflicts between your public files, and paths that you might set up using your backbone router.

</p>
<p>You may have noticed that index.html was not on the above list. If no index.html file exists in the project, backlift will create one automatically that includes links to the scripts, styles, templates that were generated based on your .backlift file.


</p>
<a name="the-admin-site"></a><h2>The admin site</h2>
<p>Each app gets a unique admin page that can be used for debugging and, in the future, managing security features like validation and authorization. You can view your app&#39;s admin page by running:

</p>
<pre><code>backlift admin</code></pre>
<p>from your app&#39;s working folder, or visit

</p>
<pre><code>https://www.backlift.com/admin#&lt;app id&gt;</code></pre>
<p>As you develop your app, this page will change to reflect your app&#39;s collections and request history. This makes it a valuable debugging tool.


</p>
<a name="data-persistence"></a><h2>Data persistence</h2>
<p>When communicating with the Backlift server, as long as you prefix your AJAX urls with &quot;/backliftapp/&quot;, the backlift server will automatically store and fetch any json data that you send. For example, in backbone, you can set the url attribute of your collections, or the urlRoot attribute of your models using the &quot;/backliftapp/&quot; prefix and then use backbone&#39;s standard save or create methods.

</p>
<p>Specifically:

</p>
<ul>
<li><p>GET /backliftapp/&lt;collection&gt;: will retrieve a list of the items in the collection.</p>
</li>
<li><p>POST /backliftapp/&lt;collection&gt;: will create a new item and add it to the collection.</p>
</li>
<li><p>PUT /backliftapp/&lt;collection&gt;/&lt;item_id&gt;: will update an item in the collection.</p>
</li>
<li><p>DELETE /backliftapp/&lt;collection&gt;/&lt;item_id&gt;: will delete an item.</p>
</li>
</ul>
<p>The data you send can either be a JSON object or a url-encoded set of key-value pairs.

</p>
<p>Backlift stores the data as JSON documents. That means you don&#39;t need to spend time defining the schema in advance. Backlift will happily persist any object with any set of attributes and make it available for retreival. Later when you want to deploy your app in a production environment, you can setup validation via the .backlift config file or the admin panel. (coming soon!)


</p>
<a name="special-object-attributes"></a><h2>Special object attributes</h2>
<p>Each time the backlift server persists a new object, a few attributes are applied automatically:

</p>
<ul>
<li><p><strong>&#39;id&#39;</strong>: If no id is set, the server will assign a unique uuid to each model and store it in the &#39;id&#39; attribute. If there is an id, backlift will ensure that it is unique. </p>
</li>
<li><p><strong>&#39;_owner&#39;</strong>: This attribute is automatically assigned to the currently logged-in user&#39;s id attribute, if there is a currently logged-in user. This value is read-only.</p>
</li>
<li><p><strong>&#39;_created&#39;</strong>: When a new object is created, this attribute is set with the current date and time in ISO standard format. This value is read-only.</p>
</li>
<li><p><strong>&#39;_modified&#39;</strong>: Each time an object is updated, this attribute is set with the current date and time in ISO standard format. This value is read-only.</p>
</li>
<li><p><strong>&#39;_id&#39;</strong>: Backlift mirrors the id attribute in an &#39;_id&#39; attribute. The &#39;_id&#39; attribute is the primary attribute used to store and retrieve data by the backlift database. In the future this attribute may be filtered out, so don&#39;t use it.</p>
</li>
</ul>

<a name="validation"></a><h1>Validation</h1>
<blockquote>
<p>   alert: This section documents preliminary functionality. 
   The functionality described below is still under development.

</p>
</blockquote>
<a name="backlift-collections-and-schemas"></a><h2>Backlift collections and schemas</h2>
<p>In backlift, the universal container is the collection. Collections are like tables in a database and are defined by a set of attributes, or fields. In backlift individual models in a collection don&#39;t need to contain all the attributes of their sibling models. However, if any of the models in a collection contain an attribute, it will be considered a part of that collection&#39;s schema.

</p>
<p>By default there are no validation rules on any models in backlift. Anything can be stored in a collection, and new collections can be created on the fly. This is useful during development when the data model of an application is changing regularly. Later, when the application is ready for production, schema validation rules may be applied to &quot;lock down&quot; the kinds of data that backlift accepts.

</p>
<p>Backlift validation is currently an active area of development, so changes may occur frequently. Our apologies.

</p>
<a name="defining-schemas"></a><h2>Defining schemas</h2>
<p>Currently backlift validation rules must be created using the .backlift configuration file. Here is an example section of the .backlift file that sets up a validation rule:

</p>
<pre><code>collections:
  tweets:
    message: {type: &#39;string&#39;, max: 140, required: yes}
    (other rules...)
  (other collections...)</code></pre>
<p>Each sub group under &#39;collections&#39; defines a new collection. When an AJAX request is sent to a /backliftapp/collection URL, backlift searches for the collection in this list. When found, the data attributes are matched against the rule names in order to select validation tests. If the data passes the tests for all attributes, the operation is permitted. 

</p>
<p>For a discussion of the permissions attributes used during authorization, see the <a href="authorization.html">authorization</a> section.

</p>
<p>The syntax for defining a new rule is:

</p>
<pre><code>&lt;field name&gt;: {[type: &#39;&lt;rule type&gt;&#39;,] &lt;parameter name&gt;: &lt;value&gt; [...]}</code></pre>
<p>If the rule &#39;type&#39; is omitted, it will be assumed to be a &#39;string&#39;.

</p>
<a name="validation-errors"></a><h2>Validation errors</h2>
<p>If one or more validation tests fail, backlift will return a 403 response along with a JSON object containing error data. The error data structure will look like this:

</p>
<pre><code>{&quot;form_errors&quot;: {
    &quot;message&quot;: [&quot;exceeds 140 character limit&quot;],
    &quot;otherfield&quot;: [&quot;required&quot;],
    &quot;&quot;: [&quot;other problems&quot;],
}}</code></pre>
<p>Each attribute of the &#39;form_errors&#39; hash is a field name, and the value is a list of error messages. The empty string attribute indicates form-wide errors.

</p>
<a name="validation-rule-reference"></a><h2>Validation rule reference</h2>
<p>The following is a list of validation rule types, and their type specific parameters.

</p>
<ul>
<li><p>&#39;<strong>auto:current_user</strong>&#39;:
A string with the current user will be substituted for the value of this attribute. This rule implies that the attribute is read-only.</p>
</li>
<li><p>&#39;<strong>auto:uuid</strong>&#39;:
A string that matches the regex pattern &#39;^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$&#39;. A random uuid matching this pattern will be substituted for this attribute&#39;s value when the object is initially created.</p>
</li>
<li><p>&#39;<strong>auto:unique_uuid</strong>&#39;:
A string that matches the regex pattern &#39;^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$&#39;. A random uuid will be substituted for this attribute&#39;s value when the object is initially created. This value will be unique amongst values for this attribute on this collection.</p>
</li>
<li><p>&#39;<strong>auto:datetime</strong>&#39;:
The current date and time in ISO standard format will be substituted for this attribute&#39;s value when the object is first created.</p>
</li>
<li><p>&#39;<strong>string</strong>&#39; (min, max):
A string with an optional minimum and maximum length. This is the default validation type for all rules.</p>
</li>
</ul>
<p>This list is incomplete at this time. We will update this list as new validation rules are created.

</p>
<p>We realize that it is impossible to perform all server side data validation using a predetermined finite set of validation rules. Our goal is not to cover all possibilities. We are currently working to define a reasonable set that covers as much territory as possible. We are also evaluating alternatives for how to handle more custom validation needs.


</p>
<a name="common-validation-rule-parameters"></a><h2>Common validation rule parameters</h2>
<p>All validation rules accept the generic parameters &#39;default&#39;, &#39;requred&#39; and &#39;readonly&#39;. 

</p>
<ul>
<li><p>The &#39;default&#39; parameter sets the value if no value is specified for an attribute.</p>
</li>
<li><p>The &#39;required&#39; parameter will ensure that a value is supplied for an attribute if set. (The value cannot be the empty string, nor can the attribute be absent entirely.)</p>
</li>
<li><p>The &#39;readonly&#39; parameter will cause the server to quietly reject any changes made to that attribute if set.</p>
</li>
</ul>
<p>A common pattern is to set a value for the &#39;default&#39; parameter, and set &#39;readonly&#39; to &#39;yes&#39;. This has the same effect of setting a fixed value for an attribute. All new objects created with these parameters will have the default value set for this attribute, which cannot be changed. This technique is effective for setting permissions on objects. See the <a href="authorization.html">authorization</a> section for further discussion.

</p>
<a name="null-values-vs-the-empty-string"></a><h2>Null values vs. the empty string</h2>
<p>There are no null values in backlift, only the empty string. (Similarly, there is no Dana, only Zuul.)

</p>

<a name="authorization"></a><h1>Authorization</h1>
<blockquote>
<p>   alert: This section documents preliminary functionality. 
   The functionality described below is still under development.

</p>
</blockquote>
<a name="creating-users-and-signing-in"></a><h2>Creating users and signing in</h2>
<p>Backlift exposes the following API to facilitate user creation and management:

</p>
<ul>
<li><p><strong>Creating users:</strong> (POST /backlift/auth/register)</p>
<p>You can create new users by sending a POST request to your app&#39;s /backlift/auth/register URL. The data you send should contain a &#39;username&#39; attribute and a &#39;password&#39; attribute, or &#39;password1&#39; and &#39;password2&#39; attributes. </p>
<pre><code>POST /backlift/auth/register {&quot;username&quot;: &quot;...&quot;, &quot;password&quot;: &quot;...&quot;}</code></pre>
<p>Currently backlift does not perform validation on usernames or passwords, except that they must exist, and in the case of password1 and password2, they must match.</p>
<p>Passwords are salted and hashed before being stored using <a href="http://bcrypt.sourceforge.net/">bcrypt</a>.</p>
</li>
<li><p><strong>Logging in:</strong> (POST /backlift/auth/login)</p>
<p>To log in a user, POST to the login url with a pair of &#39;username&#39; and &#39;password&#39; attributes. They will be compared against the salted and hashed password store and if they match, the user will be logged in.</p>
<p>When a user is logged in, two cookies will be set on the client, a session ID and a &#39;user&#39; cookie that contains the user id.</p>
</li>
<li><p><strong>Logging out:</strong> (POST or GET /backlift/auth/logout)</p>
<p>To log out a user, POST or GET to the logout url.</p>
<p>If you send a GET request, you can include a &#39;_next&#39; url parameter with a redirect url where the user will be sent after being logged out. For example the following link will log out a user and return them to the &#39;dashboard&#39; page:</p>
<pre><code>&lt;a href=&quot;/backlift/auth/logout?_next=/dashboard&quot;&gt; Log out &lt;/a&gt;</code></pre>
<p>By default the user will be redirected to &#39;/&#39; if logged out via a GET request.</p>
</li>
</ul>
<a name="permissions-and-access-control"></a><h2>Permissions and access control</h2>
<p>Backlift&#39;s authorization module allows you to control access to persisted objects. In backlift you authorize access to data, and build behaviors around that. A user profile object may be marked as readonly, which means that the server will reject attempts to update the profile object unless the currently logged-in user is the owner of that profile object.

</p>
<p>Backlift uses the following attributes on objects in order to control access:

</p>
<ul>
<li><p><strong>_owner</strong>: Whenever a user is logged-in, any objects created will have the _owner attribute set to the current user&#39;s id. This attribute is read-only and managed by the server.</p>
</li>
<li><p><strong>_groups</strong>: A list of groups to which the object belongs.</p>
</li>
<li><p><strong>_public_permissions</strong>, <strong>_group_permissions</strong>, <strong>_owner_permissions</strong>: Govern what actions are authorized on this object. It is a string containing any of the following characters. If one of the characters below is included in the string, it will grant the associated permission:</p>
<ul>
<li><strong>&#39;r&#39;</strong>: read   </li>
<li><strong>&#39;w&#39;</strong>: write   </li>
<li><strong>&#39;c&#39;</strong>: create  </li>
<li><strong>&#39;d&#39;</strong>: delete</li>
</ul>
</li>
</ul>
<p>For example, the following object is only accessible to the owner:

</p>
<pre><code>{ &quot;_owner&quot;: &quot;...&quot;, 
  &quot;_id&quot;: &quot;...&quot;, 
  &quot;_owner_permissions&quot;: &quot;rwcd&quot;,
  &quot;_group_permissions&quot;: &quot;&quot;,
  &quot;_public_permissions&quot;: &quot;&quot;}</code></pre>
<p>These are the default permissions that an object will be assigned, if the respective permissions attributes are missing on an object:

</p>
<ul>
<li>owner: read, write, create, delete</li>
<li>group: read, write</li>
<li>public: read</li>
</ul>
<a name="using-validation-rules-to-set-permissions"></a><h2>Using validation rules to set permissions</h2>
<p>Authorization depends on validation to ensure that the model attributes responsible for controlling user access are correctly configured and not altered by malicious clients. Currently these rules are set using the .backlift file. Here are a few examples of how to correctly set permissions on your models using the &#39;collections&#39; hash in the .backlift file:

</p>
<ul>
<li><p>Making the models of a collection readonly for the public:</p>
<pre><code>collections:
  tweets:
    message: {type: &#39;string&#39;, max: 140, required: yes}
    _public_permissions: {default: &#39;r&#39;, readonly: yes}</code></pre>
<p>In this example, tweets can be created and modified by users, due to default permissions. However the public can only read tweets, not change them. Tweets currently only contain the message, but could contain other attributes, such as the geo-location where the tweet was created.</p>
</li>
<li><p>Making a private user object:</p>
<pre><code>collections:
  users:
    _id: {type: &#39;auto:current_user&#39;, readonly: yes}
    _public_permissions: {default: &#39;&#39;, readonly: yes}</code></pre>
<p>This object&#39;s id is always set to the current user&#39;s id. This ensures that only one model in the &#39;users&#39; collection will exist for each user since each model &#39;_id&#39; must be unique in a collection. This object also cannot be read by the public. However the owner and member&#39;s of this object&#39;s group, if set, will have access based on the default permissions listed above.</p>
</li>
</ul>

</div>
        <footer id="footer">
            Powered by <a href="http://github.com/maximebf/beautiful-docs">beautiful-docs</a> -
            <a href="#top">Back to top</a> - <a href="/docs/all.html">Everything on a single page</a>
            - <a href="?print=1">Print current page</a> - <a href="/docs/all.html?print=1">Print all pages</a>
            
        </footer>
    </div>
</body>
</html>
